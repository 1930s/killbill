---
layout: default
---

<div class="row">
    <div class="span3 bs-docs-sidebar">
        <ul class="nav nav-list bs-docs-sidenav affix">
            <li><a href="#invoicing_overview">Overview</a></li>
            <li><a href="#invoicing_items">Invoice items</a></li>
            <li><a href="#invoicing_payments">Invoice payments</a></li>
        </ul>
    </div>

    <div class="span12">
        <section id="invoicing_overview">
            <div class="page-header">
                <h1>Overview</h1>
            </div>

            <p>Kill Bill works by triggers (as opposed to batch-oriented systems). Invoices are generated automatically, when:
                <ul>
                    <li>there is a change for a subscription (creation, change of plan, cancellation, etc.)</li>
                    <li>on a recurring phase of a subscription, the system detects a recurring charge is due (e.g. monthly recurring subscriptions)</li>
                    <li>an operator either creates an external charge, adjusts a past invoice or triggers a future invoice</li>
                </ul>
            </p>

            <p>After an invoice has been generated, its balance is positive or zero. If it's positive, the customer needs to pay its balance. Each time an invoice would become negative, the system automatically inserts a special item, called credit balance adjustment (CBA), to bring back the balance to zero. That credit is automatically added to the account and used on future invoices. If the invoice is paid, a payment is added against that payment. If that invoice is adjusted later on, a CBA item will be automatically generated and appear on the invoice. Kill Bill invoices are not static, although the items are, i.e. one can add items to past invoices.</p>

            <p>The various types of invoice items are:
                <ul>
                    <li>RECURRING: Recurring charge. Used for items with a billing period. This item is always positive or zero</li>
                    <li>FIXED: Fixed (one-time) charge. Used for items without a billing period (non recurring phase, e.g. trials). This item is always positive or zero</li>
                    <li>EXTERNAL_CHARGE: Fixed (one-time) external charge, for items not in the catalog. This item is always positive</li>
                    <li>ITEM_ADJ: Invoice item adjustment, generated by an operator (often associated with a refund). This item is always negative</li>
                    <li>REFUND_ADJ: Invoice level adjustment (against a posted payment). This item is always negative</li>
                    <li>CREDIT_ADJ: Invoice level adjustment (credits), either at the account level (on its own invoice) or against an existing invoice. This item is always negative</li>
                    <li>REPAIR_ADJ: Internal adjustment, generated automatically by the system for an invoice on which the subscription was modified (immediate cancellation or change). The items is always negative</li>
                    <li>CBA_ADJ: Internal adjustment, generated automatically by the system for an invoice which became negative (account level credits). Positive when generating credits, negative when consuming account level credits. The sum of CBA items for an account should always be positive or zero</li>
                </ul>
            </p>

            <p>Recurring invoice items start and end on the same day of the month. For example, a monthly subscription starting on the 21st will have items for the service period 2012-08-21 to 2012-09-21, 2012-09-21 to 2012-10-21, etc. Fixed items have only a start date and never get pro-rated.</p>
        </section>

        <section id="invoicing_items">
            <div class="page-header">
                <h1>Invoice items</h1>
            </div>
            <p>An invoice for a subscription on a fixed phase of $0 (trial phase for example) would look like:
                <table class="table table-condensed table-striped">
                    <thead>
                        <tr>
                            <th>Invoice #</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Start date</th>
                            <th>End date</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1028</td>
                            <td>FIXED</td>
                            <td>Silver trial</td>
                            <td>$0</td>
                            <td>2013-03-10</td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </p>
            <p>An invoice for a subscription on a recurring phase of $20 would look like:
                <table class="table table-condensed table-striped">
                    <thead>
                        <tr>
                            <th>Invoice #</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Start date</th>
                            <th>End date</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1029</td>
                            <td>RECURRING</td>
                            <td>Silver monthly</td>
                            <td>$20</td>
                            <td>2013-04-11</td>
                            <td>2013-05-11</td>
                        </tr>
                    </tbody>
                </table>
            </p>
            <p>If the user upgrades on 2013-04-26 (halfway through the month), the invoice would be repaired as follow (the CBA_ADJ item assumes the invoice was paid in full):
                <table class="table table-condensed table-striped">
                    <thead>
                        <tr>
                            <th>Invoice #</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Start date</th>
                            <th>End date</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1029</td>
                            <td>RECURRING</td>
                            <td>Silver monthly</td>
                            <td>$20</td>
                            <td>2013-04-11</td>
                            <td>2013-05-11</td>
                        </tr>
                        <tr>
                            <td>1029</td>
                            <td>REPAIR_ADJ</td>
                            <td></td>
                            <td>$-20</td>
                            <td>2013-04-11</td>
                            <td>2013-05-11</td>
                        </tr>
                        <tr>
                            <td>1029</td>
                            <td>CBA_ADJ</td>
                            <td></td>
                            <td>$20</td>
                            <td>2013-04-26</td>
                            <td>2013-04-26</td>
                        </tr>
                    </tbody>
                </table>
                and a new invoice would be generated reflecting the reality:
                <table class="table table-condensed table-striped">
                    <thead>
                        <tr>
                            <th>Invoice #</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Start date</th>
                            <th>End date</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1030</td>
                            <td>RECURRING</td>
                            <td>Silver monthly</td>
                            <td>$10</td>
                            <td>2013-04-11</td>
                            <td>2013-04-26</td>
                        </tr>
                        <tr>
                            <td>1030</td>
                            <td>RECURRING</td>
                            <td>Gold monthly</td>
                            <td>$30</td>
                            <td>2013-04-26</td>
                            <td>2013-05-11</td>
                        </tr>
                        <tr>
                            <td>1030</td>
                            <td>CBA_ADJ</td>
                            <td></td>
                            <td>$-20</td>
                            <td>2013-04-26</td>
                            <td>2013-04-26</td>
                        </tr>
                    </tbody>
                </table>
                The last negative CBA_ADJ is the account credit applied from the payment of the first invoice. The balance of the new invoice is only $20.
            </p>
            <p>An invoice item adjustment would look like (assuming the invoice wasn't paid, otherwise a CBA_ADJ item would be added):
                <table class="table table-condensed table-striped">
                    <thead>
                        <tr>
                            <th>Invoice #</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Start date</th>
                            <th>End date</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1029</td>
                            <td>RECURRING</td>
                            <td>Silver monthly</td>
                            <td>$20</td>
                            <td>2013-04-11</td>
                            <td>2013-05-11</td>
                        </tr>
                        <tr>
                            <td>1029</td>
                            <td>ITEM_ADJ</td>
                            <td></td>
                            <td>$-20</td>
                            <td>2013-04-20</td>
                            <td>2013-04-20</td>
                        </tr>
                    </tbody>
                </table>
            </p>
            <p>An invoice adjustment would look similar (assuming again the invoice wasn't paid, otherwise a CBA_ADJ item would be added):
                <table class="table table-condensed table-striped">
                    <thead>
                        <tr>
                            <th>Invoice #</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Start date</th>
                            <th>End date</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1029</td>
                            <td>RECURRING</td>
                            <td>Silver monthly</td>
                            <td>$20</td>
                            <td>2013-04-11</td>
                            <td>2013-05-11</td>
                        </tr>
                        <tr>
                            <td>1029</td>
                            <td>CREDIT_ADJ</td>
                            <td></td>
                            <td>$-20</td>
                            <td>2013-04-20</td>
                            <td>2013-04-20</td>
                        </tr>
                    </tbody>
                </table>
                A REFUND_ADJ item would be used instead of CREDIT_ADJ if the invoice was paid and a refund had been issued.
            </p>
            <p>Note that CREDIT_ADJ items are also used to represent credits created by the user (via APIs). In this case, a dummy invoice is created with a negative amount for the CREDIT_ADJ item. This makes the system generate a CBA_ADJ automatically, which in turn can be used as account credits. For example, here is how a $20 credit would be represented:
                <table class="table table-condensed table-striped">
                    <thead>
                        <tr>
                            <th>Invoice #</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Start date</th>
                            <th>End date</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1029</td>
                            <td>CREDIT_ADJ</td>
                            <td></td>
                            <td>$-20</td>
                            <td>2013-04-20</td>
                            <td>2013-04-20</td>
                        </tr>
                        <tr>
                            <td>1029</td>
                            <td>CBA_ADJ</td>
                            <td></td>
                            <td>$20</td>
                            <td>2013-04-20</td>
                            <td>2013-04-20</td>
                        </tr>
                    </tbody>
                </table>
            </p>
        </section>

        <section id="invoicing_payments">
            <div class="page-header">
                <h1>Invoice payments</h1>
            </div>
            <p>The invoice payment table is the bridge between the invoice and payment subsystems, and is used to compute invoice balances. It will contain the payments, refunds and chargebacks made against an invoice.</p>
            <p>If an invoice doesn't have any corresponding row in invoice payment, this means the invoice isn't paid (either because no payment was ever attempted, or the payment attempts weren't successful).</p>
            <p>A successful payment against an invoice would have a single row (of type ATTEMPT):
                <table class="table table-condensed table-striped">
                    <thead>
                        <tr>
                            <th>Invoice #</th>
                            <th>Type</th>
                            <th>Payment date</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1029</td>
                            <td>ATTEMPT</td>
                            <td>2013-04-12 22:45:39</td>
                            <td>$20</td>
                        </tr>
                    </tbody>
                </table>
            </p>
            <p>Here is how a payment, followed by a refund would look like:
                <table class="table table-condensed table-striped">
                    <thead>
                        <tr>
                            <th>Invoice #</th>
                            <th>Type</th>
                            <th>Payment date</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1029</td>
                            <td>ATTEMPT</td>
                            <td>2013-04-12 22:45:39</td>
                            <td>$20</td>
                        </tr>
                        <tr>
                            <td>1029</td>
                            <td>REFUND</td>
                            <td>2013-04-18 10:23:11</td>
                            <td>$-20</td>
                        </tr>
                    </tbody>
                </table>
            </p>
            <p>Here is how a payment, followed by a chargeback would look like:
                <table class="table table-condensed table-striped">
                    <thead>
                        <tr>
                            <th>Invoice #</th>
                            <th>Type</th>
                            <th>Payment date</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1029</td>
                            <td>ATTEMPT</td>
                            <td>2013-04-12 22:45:39</td>
                            <td>$20</td>
                        </tr>
                        <tr>
                            <td>1029</td>
                            <td>CHARGED_BACK</td>
                            <td>2013-04-18 10:23:11</td>
                            <td>$-20</td>
                        </tr>
                    </tbody>
                </table>
            </p>
        </section>
    </div>
</div>
