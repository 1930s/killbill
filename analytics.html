---
layout: default
---

<div class="row">
    <div class="span3 bs-docs-sidebar">
        <ul class="nav nav-list bs-docs-sidenav affix">
            <li><a href="#analytics_overview">Overview</a></li>
            <li><a href="#analytics_bac">Accounts</a></li>
            <li><a href="#analytics_bst">Subscriptions</a></li>
            <li><a href="#analytics_bin">Invoices</a></li>
            <li><a href="#analytics_bip">Payments</a></li>
            <li><a href="#analytics_bos">Overdue statuses</a></li>
            <li><a href="#analytics_tags">Tags and custom fields</a></li>
        </ul>
    </div>

    <div class="span12">
        <section id="analytics_overview">
            <div class="page-header">
                <h1>Overview</h1>
            </div>
            <p>Kill Bill maintains a reporting schema that is kept current in realtime for Analytics purposes. In contrary to other tables in the system, this set of tables is stable and potentially changes only between major revisions of Kill Bill. These tables are meant to be used as building blocks for reports and dashboards.</p>
            <p>To distinguish them with Kill Bill objects, the Analytics objects are prefixed with the term <strong>Business</strong>, e.g. a Kill Bill account will have a representation in the Analytics subsystem by a Business Account object. For ease of tracking, Analytics objects contain id references to the Kill Bill ones but we strongly advise against using them for reporting purposes. Instead, use the external keys as much as possible, as they are tied to your business concepts. For instance, to count the number of accounts in the system, run a query using <code>count(distinct account_key)</code>, not <code>count(distinct account_id)</code>.</p>
            <p>Data has been denormalized on purpose to avoid joins as much as possible.</p>
            <p>All of this information is also available in Kaui (in the analytics section), on a per account basis.</p>
        </section>

        <section id="analytics_bac">
            <div class="page-header">
                <h1>Accounts</h1>
            </div>
            <p>The table <strong>bac</strong> (Business Accounts) maintains information about Kill Bill accounts. The table doesn't contain historic records (it will contain at most one record per Kill Bill account).</p>
        </section>

        <section id="analytics_bst">
            <div class="page-header">
                <h1>Subscriptions</h1>
            </div>
            <p>The table <strong>bst</strong> (Business Subscription Transitions) maintains information about Kill Bill bundles and subscriptions. It describes the history of changes (both past and future) on a per subscription basis.</p>
            <p><strong>bst</strong> will contain all phase transitions for all subscriptions and can be used to build subscription timelines. A few remarks:
                <ul>
                    <li>Given a subscription id, events are sorted chronologically when stored (you can rely on record_id asc)</li>
                    <li>MIGRATE_BILLING, START_BILLING_DISABLED and END_BILLING_DISABLED subscription events are not stored in bst</li>
                    <li>The total_ordering column helps break ties for events with the same effective date</li>
                    <li><strong>prev_</strong> fields will always be NULL for MIGRATE, ADD and TRANSFER events</li>
                    <li><strong>next_</strong> fields will always be NULL for CANCEL events</li>
                    <li>A CHANGE event corresponds to a user initiated change (e.g. upgrade) whereas SYSTEM_CHANGE corresponds to a phase event (e.g. transition from trial to evergreen phase)</li>
                    <li>The <strong>requested_timestamp</strong> field reflects when the transition was requested, the <strong>next_start_date</strong> field reflects the effective transition time</li>
                </ul>
            </p>
        </section>

        <section id="analytics_bin">
            <div class="page-header">
                <h1>Invoices and invoice items</h1>
            </div>
            <p>The tables <strong>bin</strong> (Business Invoices), <strong>bia</strong> (Business Invoice Adjustments), <strong>biia</strong> (Business Invoice Item adjustments), <strong>biic</strong> (Business Invoice Item Credits) and <strong>bii</strong> (Business Invoice Items) maintain information about invoices posted by account.</p>
            <p>A few remarks:
                <ul>
                    <li>EXTERNAL_CHARGE, FIXED and RECURRING items are treated as regular line items (stored in bii)</li>
                    <li>ITEM_ADJ items are treated as invoice item adjustments (stored in biia)</li>
                    <li>CBA_ADJ items (gained or consumed) are treated as account credits (stored in biic)</li>
                    <li>REFUND_ADJ items are treated as invoice adjustments (stored in bia)</li>
                    <li>CREDIT_ADJ items that are not on their own invoice are treated as invoice adjustments (stored in bia). The internal name of CREDIT_ADJ is misleading in this case and will probably be renamed to INVOICE_ADJ in a future release. Note that these should not be mixed with account level credits: when an administrator creates an account credit (different from CBA credits generated by the system), a negative CREDIT_ADJ item is added to a new invoice. This triggers a positive CBA_ADJ item (to bring the balance back to zero), which effectively becomes the account credit (and eventually stored in biic). In this case, the CREDIT_ADJ item will not be stored directly in the analytics tables</li>
                    <li>Kill Bill repair items (REPAIR_ADJ) are not stored directly in any of these tables, but are combined with the new reparee item as invoice item adjustments (in biia). For example, if a recurring item of $20 was repaired into a $5 recurring item, bii would contain the original $20 line item and biia would contain a $-15 adjustment item</li>
                    <li>Any invoice item has a revenue recognizable attribute which is used to tell if the item is recognizable from a finance perspective (tied to cash). This is used for credits only today and we assume that any administrator generated credit (CREDIT_ADJ and CBA_ADJ on their own invoice) is not recognizable. All other credit items, including system generated ones, are.</li>
                </ul>
            </p>
        </section>

        <section id="analytics_bip">
            <div class="page-header">
                <h1>Payments</h1>
            </div>
            <p>The table <strong>bip</strong> (Business Invoice Payments), <strong>bipr</strong> (Business Invoice Payment Refunds) and <strong>bipc</strong> (Business Invoice Payment Chargebacks) maintain information about Kill Bill payments, refunds and chargebacks.</p>
        </section>

        <section id="analytics_bos">
             <div class="page-header">
                 <h1>Overdue statuses</h1>
             </div>

             <p>The table <strong>bos</strong> (Business Overdue Status) maintains information about Kill Bill overdue statuses. The table contains historic status for a given bundle.</p>
        </section>

        <section id="analytics_tags">
            <div class="page-header">
             <h1>Tags and custom fields</h1>
            </div>

            <p>Information about tags and custom fields are captured in the tables <strong>bac_tags</strong>, <strong>bac_fields</strong>, <strong>bin_tags</strong>, <strong>bin_fields</strong>, <strong>bip_tags</strong> and <strong>bip_fields</strong>. The tables don't contain historic records (they will contain the current state of tags and custom fields).</p>
        </section>
    </div>
</div>