RESOURCES_DIR = "src/main/resources"
KILLBILL_ROOT_PACKAGE = "com/ning/billing"
DDL_SQL_FILE = "ddl.sql"

def curl
  @curl ||= find_cmd('curl')
end

def find_cmd(cmd)
  name = cmd.upcase
  if ENV[name] and File.executable? ENV[name]
    ENV[name]
  elsif Kernel.system "/usr/bin/which  #{cmd} > /dev/null"
    cmd
  else
    s = `xcrun -find #{cmd} 2>/dev/null`.chomp
    s if $? and not s.empty?
  end
end

ddl = ""
["account", "beatrix", "entitlement", "invoice", "payment", "subscription", "tenant", "usage", "util"].each do |kmodule|
  ddl_file = "#{kmodule}/#{RESOURCES_DIR}/#{KILLBILL_ROOT_PACKAGE}/#{kmodule}/#{DDL_SQL_FILE}"
  ddl << (%x[#{curl} -skSfL "https://raw.github.com/killbill/killbill/master/#{ddl_file}"])
end

puts ddl
