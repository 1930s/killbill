---
layout: default
---

<div class="row">
    <div class="span3 bs-docs-sidebar">
        <ul class="nav nav-list bs-docs-sidenav affix">
            <li><a href="#overview">Overview</a></li>
            <li><a href="#5_minutes">Kill Bill in 5 minutes</a></li>
            <li><a href="#prod_deployment">Production deployment</a></li>
            <ul class="nav nav-list bs-docs-sidenav">
                <li><a href="#common_steps">Common steps</a></li>
                <li><a href="#installation_in_jetty">Installation in Jetty</a></li>
                <li><a href="#installation_in_tomcat">Installation in Tomcat</a></li>
                <li><a href="#installation_in_glassfish">Installation in GlassFish</a></li>
            </ul>
            <li><a href="#kaui_deployment">Kaui deployment</a></li>
            <ul class="nav nav-list bs-docs-sidenav">
                <li><a href="#kaui_new_rails_app">Deploying to a new Rails app</a></li>
                <li><a href="#kaui_config">Configuration</a></li>
            </ul>
        </ul>
    </div>

    <div class="span12">
        
        <section id="overview">
             <div class="page-header">
                 <h1>Overview</h1>
             </div>
             <p>Kill Bill as a system, is composed of several components:
                 <ul>
                     <li>The core billing platform itself, which is embedded in a web server to offer a <a href="http://kill-bill.org/api.html">REST api.</a> When we refer to Kill Bill in that documentation this is what we are referring to, unless explicitly specified</li>
                     <li>KAUI, the Kill Bill Admin UI, which is a Rails mountable engine, and communicates to the core billing platform using the REST api</li>
                     <li>A set of client libraries (Ruby, PHP) that are still under development</li>
                 </ul>
             </p>
             <br/>
             <p>Let's go through a common (web) use case of Kill Bill. One would create a custom webapp, which would contain the application's specific business logic, and have that webapp interact with Kill Bill using the REST API. In that use case, the custom webapp would:
                <ul>
                    <li>Offer a way for customers to select a plan from the Kill Bill catalog, which would result in the creation a Subscription in Kill Bill</li>
                    <li>Offer a form for customers to enter their CC information -- or any other payment method. Here depending on the payment gateway, and also on PCI compliance, the flow would differ</li>
                    <li>Offer a way for customers to review/change their subscriptions</li>
                    <li>Offer a way for customers to review/change their payment methods</li>                                
                </ul>
                It is important to understand that Kill Bill solves the billing problem but not the custom flow required around the billing platform
             </p>
             <p>Besides the main use case described above, there are other possible options if one requires going that path:
                 <ul>
                     <li>One could embed its webapp specific code inside Kill Bill, and therefore avoid having a separate web app.</li>
                     <li>Another use use case would be to embed Kill Bill into the custom web app: Below the REST API, Kill Bill offers a set of java APIs, and so it is possible to use Kill Bill as a billing library.</li>
                 </ul>
             </p>
         </section>
        
        <section id="5_minutes">
            <div class="page-header">
                <h1>Kill Bill in 5 minutes</h1>
            </div>
            <p>Run the following in a terminal prompt:
                <div class="center span7"><pre>ruby -e "$(curl -fsSL http://killbilling.org/go)"</pre></div>
            </p>
            <br/>
            <p>The only pre-requisite is MySQL. The installer will:
                <ul>
                    <li>Create a killbill database and user, and apply the correct schema</li>
                    <li>Download the latest version of killbill</li>
                    <li>Show you how to start killbill</li>
                </ul>
            </p>
            </br>
            <p>After the system has started you can experiment by following the simple scenario below. Note that each call creating an object in the system returns its URI, and so the curls below are using the UUID that was returned at the time the demo was created. You would need to replace the UUID with the one returned in each call if you were to follow that demo:
                <ul>
                     <li>The default behavior of Kill Bill is to run with authorization. In that mode, one needs to first create a tenant and specify the credentials that will be required subsequently on each call:
                      <pre>curl -X POST \
            -H 'Content-Type: application/json' \
            -H 'X-Killbill-CreatedBy: admin' \
            -d '{"apiKey": "bob", "apiSecret": "lazar"}' \
            http://127.0.0.1:8080/1.0/kb/tenants

{"uri":"/1.0/kb/tenants/e5383188-1a13-4cd7-8778-ad43f2e9529f"}
                      </pre>
                     </li>
                     <li>
                         At this point one can retrieve a simple version of the default catalog shipped with the demo:
                           <pre>curl -ubob:lazar \
            -H "Content-Type: application/json" \
            http://127.0.0.1:8080/1.0/kb/catalog/simpleCatalog

{"name":"SpyCarBasic","products":[{"type":"BASE","name":"Standard","plans":[{"name":"standard-monthly","phases":[{"type":"TRIAL","prices":{}},{"type":"EVERGREEN","prices":{"USD":100.00,"GBP":75.00}}]}],"included":[],"available":[]},{"type":"BASE","name":"Sports","plans":[{"name":"sports-monthly","phases":[{"type":"TRIAL","prices":{}},{"type":"EVERGREEN","prices":{"USD":500.00,"GBP":375.00}}]}],"included":[],"available":[]},{"type":"BASE","name":"Super","plans":[{"name":"super-monthly","phases":[{"type":"TRIAL","prices":{}},{"type":"EVERGREEN","prices":{"USD":1000.00,"GBP":750.00}}]}],"included":[],"available":[]}]}
                           </pre>
                     </li>
                     
                     <li>
                        The next step will be to create an account:
                        <pre>curl -ubob:lazar \
           -X POST \
           -H "Content-Type: application/json" \            
           -H "X-Killbill-CreatedBy: creator" \
           --data-binary '{"name":"john","email":"john@foo.com","externalKey":"xfgrdsda","currency":"USD"}' \
           http://127.0.0.1:8080/1.0/kb/accounts
           
{"uri":"/1.0/kb/accounts/8cd1fe2e-33ba-4300-b0bc-bb7b5faa9122"}
                         </pre>
                     </li>
                     <li>
                        Now we can attach a payment method. Since that demo does not have any real payment plugin attached to it, we will chose the default external payment method plugin that comes up configured in the system. That default payment plugin does not require and payment method details such as CC info, and so the pluginInfo parameter is an empty map:

                        <pre>curl -ubob:lazar \
            -X POST \
            -H "Content-Type: application/json" \            
            -H "X-Killbill-CreatedBy: creator" \
            --data-binary '{"accountId":"8cd1fe2e-33ba-4300-b0bc-bb7b5faa9122","pluginName":"__EXTERNAL_PAYMENT__","pluginInfo":{}}' \
            "http://127.0.0.1:8080/1.0/kb/accounts/8cd1fe2e-33ba-4300-b0bc-bb7b5faa9122/paymentMethods?isDefault=true"
            
{"uri":"http://127.0.0.1:8080/1.0/kb/paymentMethods/bd7c050a-0e52-4982-bbc5-0dae39494e5c"}
                     </li>
                     <li>
                        Now we will create a SubscriptionBundle on that account. This is required in oder to create the Subscription:
                     <pre>curl -ubob:lazar \
               -X POST \
               -H "Content-Type: application/json" \
               -H "X-Killbill-CreatedBy: creator" \
               --data-binary '{"accountId":"8cd1fe2e-33ba-4300-b0bc-bb7b5faa9122","externalKey":"myBundleName"}' \
               "http://127.0.0.1:8080/1.0/kb/bundles"

{"uri":"/1.0/kb/bundles/ddd1879c-0e43-45e0-bf1c-e3ada6981ad0"}
                    </pre>                     
                     </li>
                     <li>
                        The last step will be to create a subscription based on the default demo catalog:
                     <pre>curl -ubob:lazar \
               -X POST \
               -H "Content-Type: application/json" \
               -H "X-Killbill-CreatedBy: creator" \
                --data-binary '{"bundleId":"ddd1879c-0e43-45e0-bf1c-e3ada6981ad0","productName":"Standard","productCategory":"BASE","billingPeriod":"MONTHLY","priceList":"DEFAULT"}' \
                   "http://127.0.0.1:8080/1.0/kb/subscriptions"

{"uri":"/1.0/kb/subscriptions/89924c29-56f2-4587-8fa8-c09d8e5c389f"}
                    </pre>                                         
                  </li>
                  <li>
                      At this point, it is interesting to verify that the system immediately invoiced for the subscription that was created. Because the subscription is using a Plan with Trail phase of $0, there is no associated payment.
                      <pre>curl -ubob:lazar \
             -H "Content-Type: application/json" \
             -H "X-Killbill-CreatedBy: creator" \
             "http://127.0.0.1:8080/1.0/kb/invoices?accountId=8cd1fe2e-33ba-4300-b0bc-bb7b5faa9122"

[{"amount":0.00,"creditAdj":0.00,"refundAdj":0.00,"invoiceId":"eae1814a-a041-4974-80d4-426f83b04fbb","invoiceDate":"2013-05-31","targetDate":"2013-05-31","invoiceNumber":"1","balance":0.00,"accountId":"8cd1fe2e-33ba-4300-b0bc-bb7b5faa9122","auditLogs":null}]
                      </pre>
                  </li>
                 </ul>                
            </p>
        </section>
        
        <section id="prod_deployment">
            <div class="page-header">
                <h1>Production deployment</h1>
            </div>
            <p>When deploying Kill Bill to a production environment, you'll likely want to use your own container and deploy Kill Bill as a war. Below are instructions for various containers. If you're unsure which one to use and/or don't have any preference, we recommend Jetty.</p>

            <section id="common_steps">
                <div class="page-header">
                    <h2>Common steps</h2>
                </div>

                <h3>Download the latest version of Kill Bill server</h3>
                <p>Releases are available in Maven Central. Among other packaging formats, we provide a war with all dependencies. You can get the latest version <a href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22com.ning.billing%22%20AND%20a%3A%22killbill-server%22" target="_blank">here</a> (download the <code>jar-with-dependencies.war</code> artifact).</p>

                <h3>Setup the database</h3>
                <p>Create the database killbill will use and apply the latest DDL schema, which can be generated via:
                    <div class="center span7"><pre>ruby -e "$(curl -fsSL http://killbilling.org/schema)" > ddl.sql</pre></div>
                </p>
            </section>

            <section id="installation_in_jetty">
                <div class="page-header">
                    <h2>Installation in Jetty</h2>
                </div>

                <h3>Download the Jetty container</h3>
                <p>If you don't have it yet, you can download the Jetty container <a href="http://download.eclipse.org/jetty/" target="_blank">here</a>. If you're unsure which version to use, we recommend <strong>8.1.7.v20120910</strong>. Make sure you can unpack and start Jetty as described <a href="http://wiki.eclipse.org/Jetty/Howto/Install_Jetty" target="_blank">here</a>.</p>

                <p>Jetty ships with examples you can safely remove:
                    <ul>
                        <li>contexts/javadoc.xml</li>
                        <li>contexts/test.d/override-web.xml</li>
                        <li>contexts/test.xml</li>
                        <li>webapps/spdy.war</li>
                        <li>webapps/test.war</li>
                    </ul>
                </p>

                <h3>Deploy Kill Bill in Jetty</h3>
                <p>Place the downloaded Kill Bill war under <strong>webapps/root.war</strong> in the Jetty folder.</p>
                <p>Update the start.ini file with Kill Bill specific configuration. Here is a working example (make sure to adapt the jdbc properties):
                    <pre>
# Kill Bill properties
-Dcom.ning.jetty.jdbi.url=jdbc:mysql://127.0.0.1:3306/killbill
-Dcom.ning.jetty.jdbi.user=killbill
-Dcom.ning.jetty.jdbi.password=killbill

# Start classpath OPTIONS
OPTIONS=Server,resources,ext,plus,annotations

# Configuration files
etc/jetty.xml
etc/jetty-annotations.xml
etc/jetty-deploy.xml
etc/jetty-webapps.xml</pre>
                </p>
                <p>You should now be all set! Kill Bill can be started via the command <pre>java -jar start.jar</pre></p>

                <h3>Enable SSL</h3>
                <p>The following command generates a key pair and certificate directly into a keystore: <pre>keytool -keystore keystore -alias jetty -genkey -keyalg RSA</pre>Save the keystore file under the <strong>etc/</strong> directory of the Jetty distribution.</p>
                <p>In your <strong>start.ini</strong> file, add the <strong>etc/jetty-ssl.xml</strong> configuration file and edit this file to update the <strong>KeyStorePassword</strong>, <strong>KeyManagerPassword</strong> and <strong>TrustStorePassword</strong> directives with the passwords you specified when you ran the keytool command.</p>
                <p>Kill Bill should now be available over SSL. For more details, see the Jetty guide <a href="http://wiki.eclipse.org/Jetty/Howto/Configure_SSL" target="_blank">here</a>.</p>
            </section>

            <section id="installation_in_tomcat">
                <div class="page-header">
                    <h2>Installation in Tomcat</h2>
                </div>
                <p>TODO</p>
            </section>

            <section id="installation_in_glassfish">
                <div class="page-header">
                    <h2>Installation in GlassFish</h2>
                </div>
                <h3>Download the GlassFish container</h3>
                <p>If you don't have it yet, you can download the GlassFish container <a href="http://glassfish.java.net/" target="_blank">here</a>.</p>

                <h3>Deploy Kill Bill in GlassFish</h3>
                <p>Configure GlassFish with your Kill Bill specific configuration in <strong>domains/domain1/config/domain.xml</strong> (make sure to adapt the jdbc properties):
                    <pre>
&lt;jvm-options&gt;-Dcom.ning.jetty.jdbi.url=jdbc:mysql://127.0.0.1:3306/killbill&lt;/jvm-options&gt;
&lt;jvm-options&gt;-Dcom.ning.jetty.jdbi.user=killbill&lt;/jvm-options&gt;
&lt;jvm-options&gt;-Dcom.ning.jetty.jdbi.password=killbill&lt;/jvm-options&gt;</pre>
                </p>
                <p>In the <strong>glassfish</strong> directory of the unzipped GlasshFish distribution, run the following command to deploy Kill Bill: <pre>./bin/asadmin start-domain ; ./bin/asadmin deploy --contextroot "/" /path/to/killbill.war</pre></p>
            </section>
        </section>

        <section id="kaui_deployment">
            <div class="page-header">
                <h1>Kaui</h1>
            </div>
            <p>Kill Bill itself doesn't provide a UI to manage your accounts and subscriptions. All interactions with the core
                platform is expected to be done via the REST API and/or the Java APIs (if you decide to embed Kill Bill).
            </p>

            <p>Kaui (the Kill Bill Admin UI) is a UI on top of Kill Bill. It is provided as a Rails mountable engine, so you can easily
                integrate it with existing internal tools in your company, or simply use it as a standalone application.
                Note that you don't have to use Kaui in order to use Kill Bill.
            </p>

            <p>
                Besides Rails, we provide modules for other Web Frameworks. For example, Drupal users may want to use
                the <a href="https://github.com/killbill/killbill-drupal-plugin">Kill Bill Drupal plugin</a> instead.
                Checkout our <a href="https://github.com/killbill/">GitHub page</a> for other alternatives.
            </p>

            <section id="kaui_new_rails_app">
                <div class="page-header">
                    <h2>Deploying to a new Rails app</h2>
                </div>
                <p>The following guide will help you setup a brand new Rails app, called <strong>kbadmin</strong>, running Kaui.</p>
                <p>The first step is to generate a standard Rails application (note that Kaui doesn't have any database dependency): <pre>rails new kbadmin --skip-bundle --skip-active-record</pre></p>
                <p>The next step is to get the Kaui gem via Rubygems: <pre>gem install kaui</pre></p>
                <p>Finally, install Kill Bill in your new Rails app: <pre>cd kbadmin ; bundle install ; rm -f public/index.html ; kaui</pre> You're now ready to start Kaui: <pre>rails server</pre></p>
            </section>
            <section id="kaui_config">
                <div class="page-header">
                    <h2>Configuration</h2>
                </div>

                <p>By default, Kaui expects Kill Bill to run at 127.0.0.1:8080. You can override it by setting the <strong>KILLBILL_URL</strong> variable: <pre>export KILLBILL_URL="http://killbill.company.com:8080"</pre> You can also specify your tenant credentials, e.g.: <pre>export KILLBILL_URL="http://bob:lazar@127.0.0.1:8080"</pre> </p>
                <p>The kaui install script has various options, see <pre>kaui --help</pre> Among useful switches:
<pre>
# To specify the path to your app
kaui /path/to/rails/app
# For development
kaui /path/to/rails/app --path=/path/to/kaui/gem
</pre>
                </p>
            </section>
        </section>
    </div>
</div>
