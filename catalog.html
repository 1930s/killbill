<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Killbill Catalog generator</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="http://www.eslinstructor.net/vkbeautify/vkbeautify.js"></script>
    <script src="http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.js"></script>
    <link href="http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.css" type="text/css" rel="stylesheet" />
    <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css" type="text/css" rel="stylesheet" />
    <link href="http://twitter.github.com/bootstrap/assets/css/bootstrap-responsive.css" rel="stylesheet">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://twitter.github.com/bootstrap/assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://twitter.github.com/bootstrap/assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://twitter.github.com/bootstrap/assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="http://twitter.github.com/bootstrap/assets/ico/apple-touch-icon-57-precomposed.png">
    <style>
        i#addProduct {
            cursor: hand;
            cursor: pointer;
        }
        #products select {
            margin-left: 10px;
        }
    </style>

    <script type="text/javascript">
    function ISODateString() {
        var d = new Date();
        function pad(n) { return n < 10 ? '0' + n : n }
        return d.getUTCFullYear()+'-'
            + pad(d.getUTCMonth()+1)+'-'
            + pad(d.getUTCDate())+'T'
            + pad(d.getUTCHours())+':'
            + pad(d.getUTCMinutes())+':'
            + pad(d.getUTCSeconds())+'Z';
    };

    $.createElement = function(name) {
        return $('<'+name+' />');
    };

    $.fn.appendNewElement = function(name)  {
        this.each(function(i) {
            $(this).append('<'+name+' />');
        });
        return this;
    };

    function generateCatalog() {
        var $root = $('<XMLDocument />');
        $root.append
        (
            $.createElement('catalog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="CatalogSchema.xsd"')
            .appendNewElement('effectiveDate')
            .appendNewElement('catalogName')
            .appendNewElement('currencies')
            .appendNewElement('products')
            .appendNewElement('rules')
            .appendNewElement('plans')
            .appendNewElement('priceLists')
        );

        $root.find('effectiveDate').text(ISODateString());
        $root.find('catalogName').text($('#catalogName').val());

        var selectedCurrencies = $("#currencies").val() || [];
        var currenciesRoot = $root.find('currencies');
        $.each(selectedCurrencies, function(index, value) {
            var currency = $.createElement('currency').text(value);
            currenciesRoot.append(currency);
        });

        var products = $("#products input");
        var productsRoot = $root.find('products');
        $.each(products, function(index, value) {
            var productName = value.value;
            var productCategory = $('#productCategory-' + (index + 1)).val();
            var product = $.createElement('product')
                            .attr('name', productName)
                            .append($.createElement('category').text(productCategory));
            productsRoot.append(product);
        });

        return $root.html();
    };

    $(document).ready(function() {
        window.products = 1;
        $("#generate").click(
            function() {
                var catalog = generateCatalog();
                var prettyCatalog = vkbeautify.xml(catalog);
                $("#catalog").text(prettyCatalog);
                prettyPrint();
                return false;
            }
        );

        $("#addProduct").click(
            function() {
                window.products += 1;
                $('#products').append(
                    $('<div></div>')
                        .attr('class', 'control-group')
                        .append($('<label></label>')
                                    .attr('class', 'control-label')
                                    .attr('for', 'product-' + window.products)
                                    .text('Product'))
                        .append($('<div></div>')
                                    .attr('class', 'controls')
                                    .append(
                                        $('<input></input>')
                                            .attr('type', 'text')
                                            .attr('class', 'input-medium search-query')
                                            .attr('placeholder', 'Product name')
                                            .attr('id', 'product-' + window.products)
                                    )
                                    .append(
                                        $('<select></select>')
                                            .attr('id', 'productCategory-' + window.products)
                                            .append($('<option></option>').text('BASE'))
                                            .append($('<option></option>').text('ADD_ON'))
                                    )
                        )
                );
            }
        );
    });
    </script>
</head>
<body>
    <div class="container">
        <h1>Killbill Catalog generator</h1>
        <p>Configure your catalog below and click generate!</p>

        <form class="form-horizontal" action="" method="GET" name="catalog">
            <fieldset>
                <div class="control-group">
                    <label class="control-label" for="catalogName">Catalog name</label>
                    <div class="controls">
                        <input type="text" class="input-medium search-query" placeholder="Catalog name" id="catalogName">
                        <p class="help-block">The catalog name</p>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for="currencies">Supported currencies</label>
                    <div class="controls">
                        <select multiple="multiple" id="currencies">
                            <option>USD</option>
                            <option>EUR</option>
                            <option>MXN</option>
                            <option>GBP</option>
                            <option>AUD</option>
                        </select>
                    </div>
                </div>

                <div id="products">
                    <div class="control-group">
                        <label class="control-label" for="product-1">Product</label>
                        <div class="controls">
                            <input type="text" class="input-medium search-query" placeholder="Product name" id="product-1">
                            <select id="productCategory-1">
                                <option>BASE</option>
                                <option>ADD_ON</option>
                            </select>
                            <i class="icon-plus-sign" id="addProduct"></i>
                            <p class="help-block"></p>
                        </div>
                    </div>
                </div>

                <input type="submit" value="generate" id="generate">
            </fieldset>
        </form>

        <pre class="prettyprint"><code class="language-xml" id="catalog"></code></pre>
    </div>
</body>
</html>